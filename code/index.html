<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anomaly Detection Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <h2 class="text-center">üöÄ Smart Reconciliation & Anomaly Detection</h2>
        
        <!-- Upload CSV -->
        <div class="card mt-3 p-3">
            <h5>üìÇ Upload CSV for Batch Processing</h5>
            <input type="file" id="csvFile" class="form-control">
            <button class="btn btn-primary mt-2" onclick="uploadCSV()">Upload & Process</button>
        </div>

        <!-- Anomaly Detection -->
        <div class="card mt-3 p-3">
            <h5>üîç Detect Anomaly</h5>
            <textarea id="transactionInput" class="form-control" rows="4" placeholder="Enter JSON transaction data..."></textarea>
            <button class="btn btn-danger mt-2" onclick="detectAnomaly()">Check Anomaly</button>
            <div id="anomalyResult" class="mt-3"></div>
        </div>

        <!-- Root Cause Analysis -->
        <div class="card mt-3 p-3">
            <h5>üìä Root Cause Analysis</h5>
            <button class="btn btn-info" onclick="analyzeRootCause()">Analyze Root Cause</button>
            <div id="rootCauseResult" class="mt-3"></div>
        </div>

        <!-- Corrective Actions -->
        <div class="card mt-3 p-3">
            <h5>‚öôÔ∏è Suggested Corrective Actions</h5>
            <button class="btn btn-success" onclick="getCorrectiveActions()">Get Corrective Actions</button>
            <div id="correctiveActionResult" class="mt-3"></div>
        </div>

        <!-- Reconciler Feedback -->
        <div class="card mt-3 p-3">
            <h5>‚úçÔ∏è Reconciler Feedback</h5>
            <textarea id="feedbackInput" class="form-control" rows="3" placeholder="Enter feedback..."></textarea>
            <button class="btn btn-secondary mt-2" onclick="submitFeedback()">Submit Feedback</button>
            <div id="feedbackResult" class="mt-3"></div>
        </div>
    </div>

    <script>
        function detectAnomaly() {
            let transactionData = $("#transactionInput").val();
            $.post("/detect_anomaly", JSON.stringify(JSON.parse(transactionData)), function(response) {
                $("#anomalyResult").html("<b>Anomaly Detected:</b> " + (response.anomaly_detected ? "Yes ‚ùå" : "No ‚úÖ"));
            }, "json");
        }

        function analyzeRootCause() {
            let transactionData = $("#transactionInput").val();
            $.post("/root_cause", JSON.stringify(JSON.parse(transactionData)), function(response) {
                $("#rootCauseResult").html("<b>Root Cause:</b> " + response.root_cause + "<br><b>Confidence:</b> " + response.confidence_score.toFixed(2));
            }, "json");
        }

        function getCorrectiveActions() {
            let rootCause = $("#rootCauseResult").text();
            $.post("/corrective_action", JSON.stringify({ root_cause: rootCause }), function(response) {
                $("#correctiveActionResult").html("<b>Action:</b> " + response.corrective_action + "<br><b>Confidence:</b> " + response.confidence_score.toFixed(2));
            }, "json");
        }

        function submitFeedback() {
            let feedback = $("#feedbackInput").val();
            $.post("/submit_feedback", JSON.stringify({ feedback: feedback }), function(response) {
                $("#feedbackResult").html("<b>Response:</b> " + response.message);
            }, "json");
        }

        function uploadCSV() {
            let file = $("#csvFile")[0].files[0];
            let formData = new FormData();
            formData.append("file", file);

            $.ajax({
                url: "/upload_csv",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    alert("CSV Uploaded Successfully!");
                }
            });
        }
    </script>
</body>
</html>
